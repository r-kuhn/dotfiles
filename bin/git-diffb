#! /bin/bash

# Get the current branch (full ref name)
head=$(git rev-parse --symbolic-full-name HEAD)
[[ -n $head ]] || exit 1

# Get the upstream and shorten the HEAD rev
eval $(git for-each-ref --format='
upstream=%(upstream:short)
head=%(refname:short)
' "$head")

# Use the git default behaviour for control of less(1). Let git choose
# the contents of $LESS
unset LESS

# Pass the arguments on to git-diff for all the heavy lifting.
exec git diff "$@" "$upstream^{commit}" "$head^{commit}"
